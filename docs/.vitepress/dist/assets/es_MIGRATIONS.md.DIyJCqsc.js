import{_ as e,c as i,o as s,ae as o}from"./chunks/framework.BQlYxExx.js";const m=JSON.parse('{"title":"Gu√≠a de Migraciones y Mantenimiento","description":"","frontmatter":{},"headers":[],"relativePath":"es/MIGRATIONS.md","filePath":"es/MIGRATIONS.md","lastUpdated":1764098389000}'),r={name:"es/MIGRATIONS.md"};function n(t,a,c,l,d,u){return s(),i("div",null,[...a[0]||(a[0]=[o('<h1 id="guia-de-migraciones-y-mantenimiento" tabindex="-1">Gu√≠a de Migraciones y Mantenimiento <a class="header-anchor" href="#guia-de-migraciones-y-mantenimiento" aria-label="Permalink to &quot;Gu√≠a de Migraciones y Mantenimiento&quot;">‚Äã</a></h1><blockquote><p>üá∫üá∏ <strong><a href="./../en/MIGRATIONS.html">Read this in English</a></strong></p></blockquote><blockquote><p><strong>Audiencia:</strong> Ingenieros Backend, DevOps, SRE <strong>Objetivo:</strong> Proporcionar un procedimiento operativo est√°ndar (SOP) para actualizar dependencias de software y gestionar cambios en el esquema de base de datos de forma segura y predecible.</p></blockquote><h2 id="_1-migraciones-de-base-de-datos-prisma" tabindex="-1">1. Migraciones de Base de Datos (Prisma) <a class="header-anchor" href="#_1-migraciones-de-base-de-datos-prisma" aria-label="Permalink to &quot;1. Migraciones de Base de Datos (Prisma)&quot;">‚Äã</a></h2><p>Las migraciones de base de datos son una forma de gestionar cambios incrementales y reversibles en el esquema de nuestra base de datos. Cada vez que cambiamos el modelo de datos (por ejemplo, al a√±adir un campo a <code>User</code>), creamos un archivo de &quot;migraci√≥n&quot; que contiene las instrucciones espec√≠ficas (c√≥digo SQL) para aplicar ese cambio.</p><blockquote><p><strong>Para Stakeholders No T√©cnicos: Una Analog√≠a para las Migraciones</strong> Imagine que nuestra base de datos es un gran edificio cuidadosamente construido.</p><ul><li>El <strong>esquema</strong> (<code>schema.prisma</code>) es el plano oficial del edificio.</li><li>Cuando necesitamos hacer un cambio, como a√±adir una nueva habitaci√≥n, primero actualizamos el <strong>plano</strong>.</li><li>Luego, escribimos una <strong>migraci√≥n</strong>, que es un conjunto de instrucciones paso a paso para el equipo de construcci√≥n sobre c√≥mo construir esa nueva habitaci√≥n sin derribar el resto del edificio. Este proceso asegura que cada cambio sea planificado, documentado y pueda aplicarse de manera consistente en todas partes.</li></ul></blockquote><h3 id="_1-1-flujo-de-trabajo-en-desarrollo" tabindex="-1">1.1. Flujo de Trabajo en Desarrollo <a class="header-anchor" href="#_1-1-flujo-de-trabajo-en-desarrollo" aria-label="Permalink to &quot;1.1. Flujo de Trabajo en Desarrollo&quot;">‚Äã</a></h3><ol><li><strong>Modificar el Plano:</strong> Edite el archivo <code>apps/api/src/infrastructure/database/prisma/schema.prisma</code> con los cambios deseados.</li><li><strong>Generar Instrucciones de Migraci√≥n:</strong> Desde el directorio <code>apps/api</code>, ejecute:<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> migrate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nombre-descriptivo-de-la-migracio</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">n</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><ul><li><strong>¬øQu√© hace este comando?:</strong> Prisma compara su esquema actualizado con la base de datos de desarrollo. Utiliza una &quot;base de datos sombra&quot; temporal para detectar posibles problemas. Luego, genera un nuevo archivo SQL en la carpeta <code>prisma/migrations</code> con los pasos exactos y lo aplica a su base de datos local.</li></ul></li></ol><h3 id="_1-2-flujo-de-trabajo-en-produccion-y-mejores-practicas" tabindex="-1">1.2. Flujo de Trabajo en Producci√≥n y Mejores Pr√°cticas <a class="header-anchor" href="#_1-2-flujo-de-trabajo-en-produccion-y-mejores-practicas" aria-label="Permalink to &quot;1.2. Flujo de Trabajo en Producci√≥n y Mejores Pr√°cticas&quot;">‚Äã</a></h3><ul><li><strong>Mejor Pr√°ctica: Migraciones &quot;Forward-Only&quot; y No Destructivas.</strong> Debemos evitar cambios &quot;destructivos&quot; (como eliminar una columna) en las migraciones de producci√≥n. En su lugar, es preferible un proceso de varios pasos (por ejemplo, desplegar c√≥digo que deja de usar la columna, y luego desplegar una migraci√≥n para eliminarla).</li><li><strong>Aplicar Migraciones en Producci√≥n:</strong> En un pipeline de CI/CD, se utiliza el siguiente comando para aplicar todas las migraciones pendientes de forma segura:<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> migrate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deploy</span></span></code></pre></div>Este comando no es interactivo y no pedir√° confirmaci√≥n, lo que lo hace seguro para la automatizaci√≥n. Aplica las migraciones que han sido confirmadas en el control de versiones pero que a√∫n no se han ejecutado en la base de datos de producci√≥n.</li></ul><h3 id="_1-3-faq-¬øcomo-revertimos-una-migracion-fallida" tabindex="-1">1.3. FAQ: ¬øC√≥mo revertimos una migraci√≥n fallida? <a class="header-anchor" href="#_1-3-faq-¬øcomo-revertimos-una-migracion-fallida" aria-label="Permalink to &quot;1.3. FAQ: ¬øC√≥mo revertimos una migraci√≥n fallida?&quot;">‚Äã</a></h3><ul><li>Prisma no admite reversiones autom√°ticas para migraciones de producci√≥n fallidas, ya que esto puede ser peligroso. La mejor pr√°ctica es <strong>restaurar la base de datos desde la copia de seguridad</strong> realizada justo antes del despliegue (ver <code>BACKUP.md</code>) y luego corregir el archivo de migraci√≥n defectuoso en una nueva versi√≥n.</li></ul><h2 id="_2-actualizaciones-de-dependencias-de-software" tabindex="-1">2. Actualizaciones de Dependencias de Software <a class="header-anchor" href="#_2-actualizaciones-de-dependencias-de-software" aria-label="Permalink to &quot;2. Actualizaciones de Dependencias de Software&quot;">‚Äã</a></h2><h3 id="_2-1-comprobar-paquetes-desactualizados" tabindex="-1">2.1. Comprobar Paquetes Desactualizados <a class="header-anchor" href="#_2-1-comprobar-paquetes-desactualizados" aria-label="Permalink to &quot;2.1. Comprobar Paquetes Desactualizados&quot;">‚Äã</a></h3><p>Desde la ra√≠z del proyecto, ejecute <code>pnpm outdated</code> para ver una lista de dependencias que tienen nuevas versiones disponibles.</p><h3 id="_2-2-flujo-de-trabajo-de-actualizacion-segura-checklist" tabindex="-1">2.2. Flujo de Trabajo de Actualizaci√≥n Segura (Checklist) <a class="header-anchor" href="#_2-2-flujo-de-trabajo-de-actualizacion-segura-checklist" aria-label="Permalink to &quot;2.2. Flujo de Trabajo de Actualizaci√≥n Segura (Checklist)&quot;">‚Äã</a></h3><ol><li>[ ] <strong>Aislar Cambios:</strong> Cree una nueva rama de feature (<code>git checkout -b feat/update-dependencies</code>).</li><li>[ ] <strong>Actualizar:</strong> Ejecute <code>pnpm up &lt;package-name&gt;</code> para actualizar paquetes espec√≠ficos. Para una actualizaci√≥n de versi√≥n mayor (MAJOR), lea las notas de la versi√≥n del paquete en busca de cambios disruptivos.</li><li>[ ] <strong>Verificar:</strong> Ejecute la suite de pruebas completa (<code>pnpm test</code>) para detectar cualquier regresi√≥n.</li><li>[ ] <strong>Revisar:</strong> Abra un Pull Request para revisi√≥n por pares. Los cambios en el lockfile (<code>pnpm-lock.yaml</code>) deben ser parte de esta revisi√≥n.</li><li>[ ] <strong>Fusionar (Merge):</strong> Fusionar solo despu√©s de que todas las verificaciones y aprobaciones est√©n completas.</li></ol>',17)])])}const g=e(r,[["render",n]]);export{m as __pageData,g as default};
