import{_ as e,c as i,o as s,ae as t}from"./chunks/framework.BQlYxExx.js";const k=JSON.parse('{"title":"Migration & Update Guide","description":"","frontmatter":{},"headers":[],"relativePath":"technical/MAINTENANCE.md","filePath":"technical/MAINTENANCE.md","lastUpdated":1764098389000}'),n={name:"technical/MAINTENANCE.md"};function p(l,a,o,d,h,r){return s(),i("div",null,[...a[0]||(a[0]=[t(`<h1 id="migration-update-guide" tabindex="-1">Migration &amp; Update Guide <a class="header-anchor" href="#migration-update-guide" aria-label="Permalink to &quot;Migration &amp; Update Guide&quot;">​</a></h1><blockquote><p><strong>Audience:</strong> Backend Engineers, DevOps <strong>Objective:</strong> To provide a standard operating procedure (SOP) for updating dependencies and managing database schema changes safely.</p></blockquote><h2 id="_1-updating-dependencies" tabindex="-1">1. Updating Dependencies <a class="header-anchor" href="#_1-updating-dependencies" aria-label="Permalink to &quot;1. Updating Dependencies&quot;">​</a></h2><p>The project uses <code>pnpm</code> for package management.</p><h3 id="_1-1-checking-for-outdated-packages" tabindex="-1">1.1. Checking for Outdated Packages <a class="header-anchor" href="#_1-1-checking-for-outdated-packages" aria-label="Permalink to &quot;1.1. Checking for Outdated Packages&quot;">​</a></h3><p>To see a list of outdated dependencies, navigate to the project root and run:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> outdated</span></span></code></pre></div><h3 id="_1-2-updating-a-single-dependency" tabindex="-1">1.2. Updating a Single Dependency <a class="header-anchor" href="#_1-2-updating-a-single-dependency" aria-label="Permalink to &quot;1.2. Updating a Single Dependency&quot;">​</a></h3><p>To update a specific package to its latest version:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># From the project root</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">package-nam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><h3 id="_1-3-safe-update-workflow-checklist" tabindex="-1">1.3. Safe Update Workflow (Checklist) <a class="header-anchor" href="#_1-3-safe-update-workflow-checklist" aria-label="Permalink to &quot;1.3. Safe Update Workflow (Checklist)&quot;">​</a></h3><ol><li>[ ] Create a new feature branch for the updates: <code>git checkout -b feat/update-dependencies</code>.</li><li>[ ] Run the update command(s).</li><li>[ ] Review the <code>pnpm-lock.yaml</code> file to see what has changed.</li><li>[ ] <strong>Run all tests</strong> to check for regressions:<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># From the apps/api directory</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test</span></span></code></pre></div></li><li>[ ] Manually test critical API endpoints if the updated package is core to their functionality.</li><li>[ ] Commit the changes and open a Pull Request for peer review.</li></ol><h2 id="_2-database-migrations" tabindex="-1">2. Database Migrations <a class="header-anchor" href="#_2-database-migrations" aria-label="Permalink to &quot;2. Database Migrations&quot;">​</a></h2><p>The project uses <strong>Prisma</strong> to manage database schema migrations. The schema is defined in <code>apps/api/src/infrastructure/database/prisma/schema.prisma</code>.</p><h3 id="_2-1-development-workflow" tabindex="-1">2.1. Development Workflow <a class="header-anchor" href="#_2-1-development-workflow" aria-label="Permalink to &quot;2.1. Development Workflow&quot;">​</a></h3><p>When you need to make a change to the data model (e.g., add a field, create a table):</p><ol><li><p><strong>Modify the Schema:</strong> Edit the <code>schema.prisma</code> file. For example, add a new field to the <code>User</code> model:</p><div class="language-prisma vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">prisma</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">model</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ... existing fields</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  phone_number </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li><li><p><strong>Create a New Migration:</strong> Run the <code>prisma migrate dev</code> command. This will:</p><ul><li>Create a new SQL migration file in the <code>apps/api/src/infrastructure/database/prisma/migrations</code> directory.</li><li>Apply the migration to your local development database.</li><li>Update the Prisma Client (<code>@prisma/client</code>).</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># From the apps/api directory</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> migrate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dev</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add_user_phone_number</span></span></code></pre></div><p>Always provide a descriptive name for the migration.</p></li></ol><h3 id="_2-2-production-workflow" tabindex="-1">2.2. Production Workflow <a class="header-anchor" href="#_2-2-production-workflow" aria-label="Permalink to &quot;2.2. Production Workflow&quot;">​</a></h3><p>In a production environment, you <strong>do not</strong> run <code>migrate dev</code>. The workflow is designed to be non-destructive and is typically part of a CI/CD pipeline.</p><ol><li><p><strong>Generate SQL (Optional but Recommended):</strong> You can create migrations without applying them to generate the raw SQL for review.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> migrate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> diff</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --from-empty</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --to-schema-datamodel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma/schema.prisma</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --script</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> migration.sql</span></span></code></pre></div></li><li><p><strong>Apply Migrations:</strong> The standard command to apply all pending migrations in a production or staging environment is:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prisma</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> migrate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deploy</span></span></code></pre></div><p>This command runs all migration files that have not yet been applied to the target database and will not prompt for destructive actions, making it safe for automated pipelines.</p></li></ol>`,20)])])}const g=e(n,[["render",p]]);export{k as __pageData,g as default};
