service: agrobridge-api

frameworkVersion: "3"

provider:
  name: aws
  runtime: nodejs20.x
  region: us-east-1
  environment:
    NODE_ENV: production
    DATABASE_URL: # tu string de conexión
    JWT_SECRET: # ej, desde AWS Secrets Manager referenciable
    # Más variables si usas DynamoDB, etc.
  # IAM role statements for Lambda to access Secrets Manager and RDS
  iam:
    role:
      statements:
        - Effect: "Allow"
          Action:
            - "secretsmanager:GetSecretValue"
            - "rds:Connect" # If direct connection from Lambda is needed, though usually handled by VPC
          Resource: "*" # Restrict this to specific ARNs in production

functions:
  api:
    handler: src/serverless.handler
    timeout: 30
    memorySize: 1024
    events:
      - http:
          path: /{proxy+}
          method: any
          cors: true # Enable CORS for API Gateway

package:
  individually: true # Package each function separately
  patterns:
    - '!node_modules/**'
    - '!test/**'
    - '!scripts/**'
    - '!src/**/*.ts' # Exclude TypeScript source files
    - 'dist/**' # Include compiled JavaScript
    - 'node_modules/**' # Include production node_modules
    - 'src/infrastructure/database/prisma/schema.prisma' # Include Prisma schema
    - 'node_modules/.prisma/**' # Include Prisma client binaries

plugins:
  - serverless-offline
